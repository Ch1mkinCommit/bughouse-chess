body {
  --sq-size-primary: min(5vw, 9vh);
  --sq-size-secondary: calc(var(--sq-size-primary) / 1.5);
  --board-size-primary: calc(var(--sq-size-primary) * 8);
  --board-size-secondary: calc(var(--sq-size-secondary) * 8);
  --reserve-height-in-squares: 1.5;
  --rem: max(calc(var(--sq-size-primary) * 0.25), 6pt);

  --color-chalk-myself: #2b7b00;
  --color-chalk-partner: #048ea2;
  --color-chalk-opponent: #d12727;
  --color-chalk-diagonal: #9a118b;
  --color-chalk-other: #404040;
  --color-chalk-other-light: #808080;
  --color-main-scrollbar: #597121;

  --color-dialog-background: #dfceb4;
  --color-dialog-scrollbar: #aa9b24;
  --color-dialog-scrollbar-background: #c7bc7c;
  --color-dialog-tooltip: #c6bcad;
}
body.observer {
  --sq-size-primary: min(4.4vw, 7.8vh);
  --sq-size-secondary: var(--sq-size-primary);
  --color-main-scrollbar: #71755e;
}

html, body {
  height: 100%;
  width: 100%;
  font-family: Verdana, sans-serif;
  /* TODO: Figure out why setting something to `1rem` doesn't behave exactly as `var(--rem)` */
  font-size: var(--rem);
  overflow: hidden;  /* disable scroll bars */
}
html {
  display: table;
  margin: auto;
}
body {
  background-color: #1c3a0c;
  color: #e0e0e0;
  display: table-cell;
  vertical-align: middle;
}
body.observer {
  background-color: #333333;
}
body.active-player {
  background: radial-gradient(circle farthest-corner, #1c3a0c 90%, #295313 100%);
  background-attachment: fixed;
}

svg {
  overflow: visible;  /* allow shadows outside of svg area */
}

#page {
  display: grid;
  grid-template-areas:
    ".        .         .  prim-rsrv-top     .           .         .        .         ."
    ".        .         .  prim-rsrv-top     .      scnd-rsrv-top  .        .         ."
    ".  prim-name-top   .  prim-rsrv-top     .      scnd-rsrv-top  .   scnd-name-top  ."
    ".  prim-clock-top  .   prim-board       .       scnd-board    .  scnd-clock-top  ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board    scr-team   scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board       .       scnd-board    .  scnd-clock-bot  ."
    ".     prim-log     .   prim-board       .      scnd-rsrv-bot  .   scnd-name-bot  ."
    ".     prim-log     .   prim-board       .      scnd-rsrv-bot  .  scr-individual  ."
    ".     prim-log     .   prim-board       .          info       .  scr-individual  ."
    ".  prim-clock-bot  .   prim-board       .          info       .  scr-individual  ."
    ".  prim-clock-bot  .   prim-board       .         command     .  scr-individual  ."
    ".  prim-name-bot   .  prim-rsrv-bot     .      button-panel   .  scr-individual  ."
    ".        .         .  prim-rsrv-bot     .      button-panel   .  scr-individual  ."
  ;
  grid-template-columns:
    1fr
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    calc(var(--sq-size-primary) * 1.2)
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    1fr
  ;
  grid-template-rows:
    repeat(3, auto)
    4.8em
    repeat(3, auto)
    4.5em
    auto
    1fr
    repeat(4, auto)
  ;
}

body.observer #page {
  display: grid;
  grid-template-areas:
    ".        .         .  prim-rsrv-top     .      scnd-rsrv-top  .        .         ."
    ".  prim-name-top   .  prim-rsrv-top     .      scnd-rsrv-top  .   scnd-name-top  ."
    ".  prim-clock-top  .   prim-board       .       scnd-board    .  scnd-clock-top  ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board    scr-team   scnd-board    .     scnd-log     ."
    ".     prim-log     .   prim-board       .       scnd-board    .     scnd-log     ."
    ".  prim-clock-bot  .   prim-board       .       scnd-board    .  scnd-clock-bot  ."
    ".  prim-name-bot   .  prim-rsrv-bot     .      scnd-rsrv-bot  .   scnd-name-bot  ."
    ".        .         .  prim-rsrv-bot     .      scnd-rsrv-bot  .  scr-individual  ."
    ".        .         .      info          .        command      .  scr-individual  ."
    ".        .         .      info          .      button-panel   .  scr-individual  ."
    ".        .         .      info          .           .         .  scr-individual  ."
  ;
  grid-template-columns:
    1fr
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    calc(var(--sq-size-primary) * 1.2)
    auto
    calc(var(--sq-size-primary) * 0.4)
    auto
    1fr
  ;
  grid-template-rows:
    repeat(2, auto)
    5em
    repeat(3, auto)
    4.5em
    repeat(3, auto)
    1fr
  ;
}

#board-primary { grid-area: prim-board; }
#reserve-primary-top { grid-area: prim-rsrv-top; }
#reserve-primary-bottom { grid-area: prim-rsrv-bot; }
#player-name-container-primary-top { grid-area: prim-name-top; }
#player-name-container-primary-bottom { grid-area: prim-name-bot; }
#clock-container-primary-top { grid-area: prim-clock-top; }
#clock-container-primary-bottom { grid-area: prim-clock-bot; }
#turn-log-container-primary { grid-area: prim-log; }

#score-team { grid-area: scr-team; }
#participant-container { grid-area: scr-individual; }

#board-secondary { grid-area: scnd-board; }
#reserve-secondary-top { grid-area: scnd-rsrv-top; }
#reserve-secondary-bottom { grid-area: scnd-rsrv-bot; }
#player-name-container-secondary-top { grid-area: scnd-name-top; }
#player-name-container-secondary-bottom { grid-area: scnd-name-bot; }
#clock-container-secondary-top { grid-area: scnd-clock-top; }
#clock-container-secondary-bottom { grid-area: scnd-clock-bot; }
#turn-log-container-secondary { grid-area: scnd-log; }

#info-string-container { grid-area: info; }
#command { grid-area: command; }
#button-panel { grid-area: button-panel; }

.align-left {
  width: 100%;
  text-align: left;
}
.align-right {
  width: 100%;
  text-align: right;
}
.align-center {
  width: 100%;
  text-align: center;
}
.flex-row {
  width: 100%;
  display: flex;
  flex-direction: row;
  gap: 0.5em;
}
.flex-equisized {
  flex-basis: 0;
  flex-grow: 1;
}

.board-shadow {
  fill: #808080;
  stroke: none;
  filter: url(#board-shadow);
}
.board-border {
  fill: none;
  stroke: #000000;
  stroke-width: 0.02;
}

.sq-black {
  fill: #e59349;
}
.sq-white {
  fill: #dfceb4;
}

.on-sq-black {
  fill: #dfceb4;
  font: normal 0.25px sans-serif;
}
.on-sq-white {
  fill: #e59349;
  font: normal 0.25px sans-serif;
}

.latest-turn-from,
.latest-turn-from-extra {
  fill: #acbd38;
  opacity: 0.5;
}
.latest-drop-to,
.latest-turn-to,
.latest-turn-to-extra {
  fill: #a7c000;
  opacity: 0.5;
}

.pre-turn-from,
.pre-turn-from-extra {
  fill: #7238bd;
  opacity: 0.5;
}
.pre-drop-to,
.pre-turn-to,
.pre-turn-to-extra {
  fill: #5800c0;
  opacity: 0.5;
}

.latest-capture {
  fill: #4dcc7d;
  opacity: 0.5;
}

.legal-move-highlight {
  /* Disable until there is an understanding whether we actually want this. */
  /* fill: url(#legal-move-gradient); */
  fill: none;
}
.drag-start-highlight {
  fill: url(#drag-start-gradient);
}
.drag-over-highlight {
  fill: url(#drag-over-gradient);
}

.draggable {
  cursor: grab;
}
.draggable.dragged {
  cursor: grabbing;
}

.chalk-arrow {
  fill: none;
  stroke-width: 0.25;
  stroke-linecap: butt;
  opacity: 0.6;
  pointer-events: none;
}
.chalk-freehand-line {
  fill: none;
  stroke-width: 0.15;
  stroke-linejoin: round;
  stroke-linecap: round;
  opacity: 0.6;
  pointer-events: none;
}
.chalk-square-highlight {
  stroke: none;
  opacity: 1.0;
  pointer-events: none;
}

.chalk-line-myself { stroke: var(--color-chalk-myself); }
.chalk-line-partner { stroke: var(--color-chalk-partner); }
.chalk-line-opponent { stroke: var(--color-chalk-opponent); }
.chalk-line-diagonal { stroke: var(--color-chalk-diagonal); }
.chalk-line-other { stroke: var(--color-chalk-other); }

.chalk-arrow.chalk-line-myself { marker-end: url(#arrowhead-myself); }
.chalk-arrow.chalk-line-partner { marker-end: url(#arrowhead-partner); }
.chalk-arrow.chalk-line-opponent { marker-end: url(#arrowhead-opponent); }
.chalk-arrow.chalk-line-diagonal { marker-end: url(#arrowhead-diagonal); }
.chalk-arrow.chalk-line-other { marker-end: url(#arrowhead-other); }

.chalk-square-myself { fill: var(--color-chalk-myself); }
.chalk-square-partner { fill: var(--color-chalk-partner); }
.chalk-square-opponent { fill: var(--color-chalk-opponent); }
.chalk-square-diagonal { fill: var(--color-chalk-diagonal); }
.chalk-square-other { fill: var(--color-chalk-other-light); }

#arrowhead-myself { fill: var(--color-chalk-myself); }
#arrowhead-partner { fill: var(--color-chalk-partner); }
#arrowhead-opponent { fill: var(--color-chalk-opponent); }
#arrowhead-diagonal { fill: var(--color-chalk-diagonal); }
#arrowhead-other { fill: var(--color-chalk-other); }

#board-primary {
  width: calc(var(--sq-size-primary) * 8);
  height: calc(var(--sq-size-primary) * 8);
  user-select: none;
  touch-action: none;
  z-index: 20;  /* show dragged pieces above other UI elements */
}
#board-secondary {
  width: calc(var(--sq-size-secondary) * 8);
  height: calc(var(--sq-size-secondary) * 8);
  user-select: none;
}
#reserve-primary-top,
#reserve-primary-bottom {
  width: calc(var(--sq-size-primary) * 8);
  height: calc(var(--sq-size-primary) * 1.5);
  user-select: none;
  touch-action: none;
}
#reserve-secondary-top,
#reserve-secondary-bottom {
  width: calc(var(--sq-size-secondary) * 8);
  height: calc(var(--sq-size-secondary) * 1.5);
  user-select: none;
}
.reserve {
  filter: url(#reserve-shadow);
}
body.observer .reserve {
  filter: url(#reserve-shadow-gray);
}

#player-name-container-primary-top,
#player-name-container-primary-bottom {
  /* Align right and put status emojis (like “⚠️” on the right).
     TODO: Safer solution that wouldn't break if we allow emojis in player names. */
  direction: rtl;
}
.player-name {
  width: 0;
  font-size: 110%;
  white-space: pre;
  color: #a4b984;
  padding: calc(var(--sq-size-primary) * 0.1) 0;
}
body.observer .player-name {
  color: #b2b2b2;
}
#score-team,
#score-individual,
#observers {
  color: #7fb5a1;
}
#score-team {
  text-align: center;
  white-space: pre;
}
#participant-container {
  width: 0;
  display: flex;
  flex-direction: column;
}
#score-individual-container {
  display: flex;
  flex-direction: row;
}
#score-individual {
  white-space: pre;
  border-top: 0.2em solid #7fb5a1;
  margin-top: 1em;
  padding: 0.5em 0;
}
#observers {
  white-space: pre;
  font-size: 90%;
}

.clock {
  font-family: Monaco, monospace;
  font-size: 180%;
  text-align: center;
  white-space: nowrap;
  min-width: 3em;
  display: inline-block;
  border-radius: calc(var(--sq-size-primary) * 0.2);
  padding: calc(var(--sq-size-primary) * 0.05) calc(var(--sq-size-primary) * 0.1);
  margin: calc(var(--sq-size-primary) * 0.2)  0;
}
.clock-inactive {
  color: #909090;
  background-color: #28351f;
  outline: calc(var(--sq-size-primary) * 0.03) solid #74935f;
}
.clock-active {
  font-weight: bold;
  color: #f0f0f0;
  background-color: #1f5800;
  outline: calc(var(--sq-size-primary) * 0.1) outset #63ba25;
}
.clock-active.clock-low-time {
  font-weight: bold;
  color: #f0f0f0;
  background-color: #435700;
  outline: calc(var(--sq-size-primary) * 0.1) outset #ddd712;
}
.clock-flag {
  font-weight: bold;
  color: #909090;
  background-color: #691400;
  outline: calc(var(--sq-size-primary) * 0.1) solid #bf0000;
}
body.observer .clock-inactive {
  background-color: #2a2a2a;
  outline-color: #8a8a8a;
}
body.observer .clock-active {
  background-color: #345423;
  outline-color: #85b363;
}
body.observer .clock-active.clock-low-time {
  background-color: #4a5616;
  outline-color: #dad26e;
}

#clock-container-primary-top,
#clock-container-primary-bottom {
  text-align: right;
  padding: calc(var(--sq-size-primary) * 0.1) 0;
}
#clock-container-secondary-top,
#clock-container-secondary-bottom {
  text-align: left;
  padding: calc(var(--sq-size-primary) * 0.1) 0;
}

#info-string-container {
  flex: 1;
  margin-bottom: 0.5em;
  position: relative;
}
#info-string {
  font-size: 90%;
  white-space: pre-wrap;
  position: absolute;
  bottom: 0;
  left: 0;
  /* Note: `z-index` and `background-color` are a "solution" for info-string text overflow. */
  z-index: 10;
  background-color: #1c3a0c80;
}
body.observer #info-string {
  top: 0;
  bottom: auto;
  background-color: #33333380;
}
#command {
  flex-grow: 1;
  box-sizing: border-box;
  background-color: #8ea36e;
  font-size: 1em;
}
body.observer #command {
  background-color: #9a9a9a;
}

dialog {
  scrollbar-gutter: stable;
  scrollbar-color: var(--color-dialog-scrollbar) var(--color-dialog-scrollbar-background);
  scrollbar-width: thin;
}
dialog ::-webkit-scrollbar {
  width: max(2px, 0.3em);
}
dialog ::-webkit-scrollbar-track {
  background: var(--color-dialog-scrollbar-background);
}
dialog ::-webkit-scrollbar-thumb {
  background-color: var(--color-dialog-scrollbar);
}

#page {
  scrollbar-gutter: stable;
  scrollbar-color: var(--color-main-scrollbar) #ffffff00;
  scrollbar-width: thin;
}
#page ::-webkit-scrollbar {
  width: max(2px, 0.3em);
}
#page ::-webkit-scrollbar-track {
  background: none;
}
#page ::-webkit-scrollbar-thumb {
  background-color: var(--color-main-scrollbar);
}

#turn-log-container-primary {
  text-align: right;
}
#turn-log-container-secondary {
  text-align: left;
}
.turn-log-scroll-area {
  text-align: left;
  font-size: 80%;
  display: inline-block;
  min-width: 7.8em;
  height: 100%;
  /* background-color: #ffffff0b; */
  overflow-x: visible;
  overflow-y: scroll;
  box-shadow: 0.05em 0.05em 0.2em #00000080;
}
.turn-log {
  height: 0;
  white-space: pre;
  color: #ffffffa0;
}
/* Put scrol bars on the left */
#turn-log-scroll-area-primary { direction: rtl; }
#turn-log-primary { direction: ltr; }
.turn-record {
  padding: 0.15em 0.6em;
}
.turn-record-white {
  background-color: #ffffff0c;
}
.turn-record-black {
  background-color: #0000001a;
}

#command {
  width: max(var(--board-size-secondary), 6em);
}
#button-panel {
  margin-top: 1em;
  display: flex;
  flex-direction: row;
  gap: 0.2em;
  justify-content: space-between;
}
.button-subpanel {
  display: flex;
  flex-direction: row;
  gap: 0.2em;
}

#connection-info {
  position: absolute;
  top: 0.5em;
  right: 0.5em;
  font-size: 60%;
  color: #ffffff60;
  z-index: -10;
}
#connection-info.bad-connection {
  font-weight: bold;
  background-color: #ffd0d0c0;
  border: 0.5em solid transparent;
  color: #6e0000;
}

.tooltip {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  margin-left: 0.5em;
  width: 1.5em;
}

.tooltip .tooltip-text {
  visibility: hidden;
  text-align: initial;
  font-size: 90%;
  width: 15em;
  background-color: var(--color-dialog-tooltip);
  padding: 0 1em;
  border-radius: 0.5em;
  position: absolute;
  z-index: 1;
  top: 0%;
  left: 100%;
  margin-left: 1.8em;
  opacity: 0;
  transition: opacity .3s;
  transform: translate(0, -50%) translate(0, 2em);
}
/* Tooltip arrow */
.tooltip .tooltip-text::after {
  content: "";
  position: absolute;
  top: 50%;
  right: 100%;
  margin-top: -0.5em;
  border-width: 0.5em;
  border-style: solid;
  border-color: transparent var(--color-dialog-tooltip) transparent transparent;
}

.tooltip::after {
  font-size: 120%;
  content: "ⓘ";
}
.tooltip:hover::after {
  content: "📖";
}
.tooltip:hover {
  cursor: help;
}
.tooltip:hover .tooltip-text {
  font-weight: normal;
  visibility: visible;
  opacity: 1;
}

dialog {
  background-color: var(--color-dialog-background);
  /* font-size: max(1em, 8pt); */
  padding: 0.6em 1em;
  overflow: visible;  /* allow tooltips go outside of the page area */
}

dialog::backdrop {
  background: #000000a0;
}

.menu-page-body {
  display: grid;
  grid-template-columns: auto auto auto;
}

label {
  display: flex;
  align-items: center;
  /* Note: prefer padding over `column-gap`, because this way the entire line is clickable. */
  padding-right: 1em;
}

dialog hr {
  border: none;
  border-top: 1px solid #ab8562;
  overflow: visible;
  text-align: center;
  height: 0;
}
dialog hr:after {
  background: var(--color-dialog-background);
  color: #785636;
  content: '♞';
  padding: 0 0.4em;
  position: relative;
  top: -0.85em;
}

dialog button {
  display: inline-block;
  padding: 0.5em 1em;
  margin: 0.35em 0;
  border: 0;
  font-size: 1em;
  text-align: center;
  color: #101010;
  border-radius: 0.5em;
  background-color: #eed5ae;
  background-image: linear-gradient(to top left,
                                    rgba(0, 0, 0, 0.1),
                                    rgba(0, 0, 0, 0.1) 30%,
                                    rgba(0, 0, 0, 0));
  box-shadow: inset 2px 2px 3px rgba(255, 255, 255, .6),
              inset -2px -2px 3px rgba(0, 0, 0, .6);
}
dialog button:hover {
  background-color: #f3debd;
}
dialog button:active {
  box-shadow: inset -2px -2px 3px rgba(255, 255, 255, .6),
              inset 2px 2px 3px rgba(0, 0, 0, .6);
}

.big-button {
  width: 14em;
  font-size: 1.3em;
  text-shadow: 0.05em 0.05em 0.05em #eaac73;
  background-color: #e59f5f;
}
.big-button:hover {
  background-color: #eaac73;
}
.back-button {
  padding: 0;
  height: 2em;
  width: 2em;
  border-radius: 0.3em;
}

dialog select, dialog input {
  display: block;
  box-sizing: border-box;
  padding: 0.3em 1em;
  margin: 0.4em 0em;
  width: 100%;
  font-size: 1.1em;
  border-width: 1px;
  border-color: #808080;
  border-radius: 0.2em;
  background-color: #f0e8dc;
}

/* The point of `:not(:placeholder-shown)` is to not make the cursor red if the input field is blank.
   Here `:placeholder-shown` is an emptiness marker. Could switch to `:blank` if it's standardized. */
dialog input:invalid:not(:placeholder-shown) {
  color: red;
}

#jc-contest-id:not(:placeholder-shown) {
  /* This is of course a purely visual change. Actual input should be uppercased in JS. */
  text-transform: uppercase;
}

#about-text {
  overflow-y: scroll;
  width: calc(min(40em, 80vw));
  height: calc(min(40em, 70vh));
  padding-right: 0.8em;
}
#about-text hr {
  width: 50%;
}

#lobby-participants {
  min-width: 10em;
  font-size: 110%;
  display: grid;
  grid-template-columns: 1fr auto auto;
  column-gap: 0.5em;
  row-gap: 0.5em;
  align-items: center;
  user-select: none;  /* prevent accidental name selection when choosing a team */
}
#lobby-contest {
  font-size: 110%;
}
#lobby-contest-id {
  font-weight: bold;
}
#lobby-rules {
  white-space: pre;
  margin: 0.8em 0;
}
.lobby-icon {
  width: 2em;
  height: 2em;
}
.lobby-name.lobby-me {
  font-size: 110%;
  font-weight: bold;
}
.lobby-me .readiness-checkbox { stroke: #82a12f; }
.lobby-me .readiness-checkmark { stroke: #5c9611; }
.lobby-other .readiness-checkbox { stroke: #978e86; }
.lobby-other .readiness-checkmark { stroke: #a49141; }
.lobby-icon.lobby-me {
  scale: 130%;
}
.lobby-icon.lobby-me > *:first-child {
  filter: url(#icon-shadow);
}
.lobby-icon:not(.lobby-me) {
  filter: saturate(0.9) contrast(0.7) brightness(1.1);
}

.simple-dialog-message {
  font-size: 110%;
}
.simple-dialog-button-box {
  float: right;
  margin-left: 4em;
  margin-top: 0.5em;
  display: flex;
  flex-direction: row;
  gap: 0.6em;
}

.icon-button {
  box-sizing: border-box;
  padding: 0;
  border: none;
  border-radius: calc(var(--sq-size-primary) * 0.2);  /* for hover hightlight */
  background-color: transparent;
  width: calc(var(--sq-size-primary) * 0.6);
  height: calc(var(--sq-size-primary) * 0.6);
  cursor: pointer;
}
.icon-button:hover {
  background-color: #ffffff30;
}
.icon-button:active {
  background-color: #ffffff50;
}

.icon-button-svg {
  fill: #ffffff;
}
.icon-button-svg:active {
  fill: #ceffb4;
}
